{
    "contents" : "#################\n# Purpose:\n# to explore the events log for module CMPST_0699 Semester 3 2014/15\n# I'm looking to be able to 'plot' the course to provide a background \n#  a) advice for students of current cohort and \n#  b) personal performance of individuals this time against historical\n#\n#################\n\n\nrm(list=ls())\n\nsetwd='d:/Data/16022015/FROZEN cmpstr_00699 Semester 1 2014-15'\n\n####\n# to start with I want to get a list of student ids from the cohort - I only want those who passed the essay\n# this file has results data for the module\n####\n\nusers <- read.csv('CMPST_00699 essay data.csv')\ntotalstu<-nrow(users)\n#totalstu\nusers <- subset(users, users$E.MARK > 40, select=c(EID, E.MARK)) # I dont need all of the vectors\n#head(users)\npassstu<-nrow(users)  # i will use this as an indication of relevant events - I'm thinking 10%\n#passstu\n####\n# now I have that list I can right join with the events for this course to filter only those users events in the list\n####\n\nevents <- read.csv('little.csv')  ## events for cmpst_0600 (cut down)\nevents <- merge(events, users, by='EID', all.y=T)\n# head(events)\n\n####\n# I'm not interested in lots of the events - there are so few or meaningless. Subsetting can remove\n####\n\nevents <- subset(events, events$EVENT != 'pres.end') \nevents <- subset(events, events$EVENT != 'messages.delete') \nevents <- subset(events, events$EVENT != 'messages.movedtodeletefolder') \nevents <- subset(events, events$EVENT != 'messages.newfolder') \nevents <- subset(events, events$EVENT != 'msnd.email.send') \n\nevents$EVENT <- factor(events$EVENT)    # refactoring gets rid of empty levels \nevents$EID <- factor(events$EID)        # and ids not used\n\n####\n# I need to rename a number of events for easier reading when plotting later\n####\n\nlevels(events$EVENT)[levels(events$EVENT)==\"asn.read.assignment\"] <- \"Assign.Read\"\nlevels(events$EVENT)[levels(events$EVENT)==\"asn.read.submission\"] <- \"Assign.Results\"\nlevels(events$EVENT)[levels(events$EVENT)==\"melete.section.read\"] <- \"Pathway.Read\"\nlevels(events$EVENT)[levels(events$EVENT)==\"asn.submit.submission\"] <- \"Assign.Submit\"\nlevels(events$EVENT)[levels(events$EVENT)==\"messages.forward\"] <- \"Mess.Forward\"\nlevels(events$EVENT)[levels(events$EVENT)==\"messages.reply\"] <- \"Mess.Reply\"\nlevels(events$EVENT)[levels(events$EVENT)==\"messages.read\"] <- \"Mess.Read\"\nlevels(events$EVENT)[levels(events$EVENT)==\"messages.new\"] <- \"Mess.New\"\nlevels(events$EVENT)[levels(events$EVENT)==\"chat.new\"] <- \"Chat.New\"\nlevels(events$EVENT)[levels(events$EVENT)==\"forums.read\"] <- \"Forum.Read\"\nlevels(events$EVENT)[levels(events$EVENT)==\"forums.response\"] <- \"Forum.Reply\"\nlevels(events$EVENT)[levels(events$EVENT)==\"forums.new\"] <- \"Forum.Post\"\nlevels(events$EVENT)[levels(events$EVENT)==\"content.read\"] <- \"Resource.Read\"\n\n# combine two\n\nlevels(events$EVENT)[levels(events$EVENT)==\"pres.begin\"] <- \"Join site\"\nlevels(events$EVENT)[levels(events$EVENT)==\"site.upd\"] <- \"Join site\"\n\n\n####\n# some playing around understanding how I can extract information from a table\n####\n\n#mytable <- table(events$EVENT, events$EID) # events against users contingency table\n#margin.table(mytable,1) # row marginal frequencies\n#margin.table(mytable,2) # column marginal frequencies\n#prop.table(mytable)  # cell percentage\n#round(prop.table(mytable,1),2) # row percentages\n#round(prop.table(mytable,2),2) # column percentages\n#ftable(mytable)  #pretty(ish) display\n\n####\n# crosstabs let me compare events by user\n####\n\nmyxtab <- xtabs(~EVENT+EID, data=events) # creates a crosstab\n#myxtab\n\n####\n# jiggery pokery here turns the xtab into a flat table\n# then to a data.frame\n# which I can use for plots\n####\n\nmyft <- ftable(myxtab) # makes a flat table, works with contingency or other tables\n#myft\n\n####\n# myft is a table cross matching user by event individual cells showing the frequency of events\n####\n\nmydfft <- as.data.frame(myft) # converting to a data.frame offers  more precision\n#mydfft\n\n####\n# mydfft is now a list of every event by every user with a Freq count \n####\n\nplot(mydfft$EVENT, \n     mydfft$Freq, \n     las=2) ## plots EVENTS against frequency \n\n####\n# this does stacked bars for each user\n#### \n\npar(mar=c(5,5,1,1)) # more space for bottom margin\nbarplot(myxtab, \n        xlab=\"Freq.\", \n        #ylab=\"User\", \n        las=2,  # vertical labels at bottom\n        legend=T,\n        horiz=T,\n        col=unique(myxtab)) # events by user las=2 is vertical labels on yaxis\n\n\n####\n# printing sorted boxplot for events \n####\n\n# organise by median of each event frequency - it just works!\nmydf2 <- with(mydfft,factor(EVENT,levels=levels(EVENT)[order(tapply(Freq,EVENT,median))])) \n\npar(mar=c(5,9,3,1))   # margins\nboxplot(mydfft$Freq~mydf2, \n        mydfft$EVENT, \n        las=2, \n        col='lightgray',\n        horizontal=T,\n        staplewex=1,\n        outline=F,                    # outline=FALSE removes individual marks to make it fit \n        main=\"Boxplot of student activity\") \n\n# i want to add labels of median, lower, upper\n# so i need the values underlying th plot\n\nthisplot <- boxplot(mydfft$Freq~mydf2, \n                    mydfft$EVENT, \n                    horizontal=T,\n                    outline=F,                    # outline=FALSE removes individual marks to make it fit \n                    plot=F) \n#thisplot\n\n# i am here just creating a simple table to show boxplot values\nmydisttable <- thisplot$stats\ncolnames(mydisttable) <- thisplot$names\nrownames(mydisttable) <- c('min','25%', 'median','75%', 'max')\n#mydisttable\n\ndf.table<-as.data.frame(mydisttable)\n#df.table\n\n####\n# here I am going to remove those events where there isnt a very high median\n####\n\n#finding median over 10% of sample as dont want to show smaller\nlowest=passstu/10\n#lowest\n\nz<-which(df.table[3,] > lowest)    #find where 3rd row (median) is greater than 5\n#z\ndf.table<-df.table[z] # take only columns in the vector created above\n#df.table\n\npar(mar=c(5,5,5,0),bty='n',cex.axis=.7)   # margins, no box, axis text smaller\nboxplot(df.table, \n        horizontal=T, \n        las=2,\n        axes=T,\n        boxwex=0.6, # width of boxes\n        col.axis='blue', # axis colour\n        col='lightgray')\n\n\n\n\n### my first function - just plots values onto a boxplot\nmyfunction <- function(colnum,values) {\n  text(x=values, labels=values, y=colnum+0.5,col='blue', cex=0.5, srt=90)   #\n}\n\nz<-ncol(df.table)\ni<-1\nfor (i in 1:z) {\n  myfunction(i,df.table[,i])\n\n}\n\nymax<-max(df.table)\n\n# stick some sample size data on\ntext(x=ymax,labels=paste('Passes: (shown)',passstu),y=1,adj=1)\ntext(x=ymax,labels=paste('Participants:',totalstu),y=1.5, adj=1)\n\n\n#### and adding back individual students ...\n\n# subset xtab for student EID 492119\nmydfft\nthis.dt<-subset(mydfft,mydfft$EID=='492119')\nthis.dt\n\n# now plot against each of the boxplot lines the data in this.dt\ndf.table\ninterest<-names(df.table)\n\ni<-1\nfor (i in 1:z) {\n  val<-this.dt$Freq[this.dt$EVENT==interest[i]]\n  pchval<-16\n  points(val,i, pch=pchval, col='orange')\n}\n\n\n\n\n\n\n",
    "created" : 1427143577100.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "370030489",
    "id" : "930BB808",
    "lastKnownWriteTime" : 1427140798,
    "path" : "E:/data/GitHub/Analytics-ISL-Project/skillsbp.R",
    "project_path" : "skillsbp.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}